<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin Login</title>
  <style>
    :root {
      --bg: #0a0a0a;
      --ink: #e5e7eb;
      --accentA: #ff0033;
      --accentB: #ffcc00;
      --brand: #ff1a1a;
      --card: #0f0f13;
      --muted: #9ca3af;
      --danger: #ff3333;
      --ok: #10b981;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, Noto Sans;
      color: var(--ink);
      background:
        radial-gradient(1200px 600px at 120% -10%, #4d0000 0%, transparent 60%),
        radial-gradient(900px 500px at -10% 120%, #332200 0%, transparent 55%),
        linear-gradient(180deg, #0a0a0a 0%, #0b0b0b 100%);
      min-height: 100vh;
      display: grid;
      grid-template-rows: auto 1fr auto;
    }
    header {
      background: linear-gradient(90deg, var(--accentA), var(--accentB));
      text-align: center;
      padding: clamp(16px, 3vw, 28px);
      box-shadow: 0 4px 30px rgba(0,0,0,.4);
    }
    header h1 {
      margin: 0; color: #fff; font-size: clamp(22px, 5vw, 36px);
      text-shadow: 0 0 12px rgba(255,26,26,.6), 0 0 22px rgba(255,204,0,.35);
    }
    header p { margin: 6px 0 0; color: #ffe9e9; font-size: 14px; }

    main { display: grid; place-items: center; padding: 20px; }

    .card {
      width: min(540px, 92vw);
      background: var(--card);
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 18px;
      box-shadow: 0 12px 30px rgba(0,0,0,.6), inset 0 0 0 1px rgba(255, 0, 0, 0.12);
      padding: 22px;
      margin-bottom: 20px;
      text-align: left;
    }
    .card h2 { margin: 0 0 12px; }

    label { font-size: 13px; color: #fca5a5; text-transform: uppercase; letter-spacing: .6px; }
    input, textarea {
      width: 100%;
      padding: 12px 14px;
      margin-top: 6px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.12);
      background: #0b0c10;
      color: var(--ink);
      font-size: 15px;
    }
    input:focus, textarea:focus { outline: none; box-shadow: 0 0 0 4px rgba(255,26,26,.25); border-color: rgba(255,204,0,.4); }

    button, .btn-link {
      display: inline-block;
      margin-top: 12px;
      width: 100%;
      padding: 12px 16px;
      font-weight: 800;
      border: none;
      border-radius: 14px;
      background: var(--brand);
      color: #fff;
      cursor: pointer;
      box-shadow: 0 10px 24px rgba(255,0,0,.25), inset 0 -2px 0 rgba(0,0,0,.3);
      text-align: center;
      text-decoration: none;
    }
    button:active, .btn-link:active { transform: translateY(1px) scale(.995); }

    .error { color: var(--danger); font-size: 14px; margin-top: 8px; text-shadow: 0 0 8px rgba(255,0,0,.45); }
    .hint { color: var(--muted); font-size: 12px; margin-top: 6px; }
    .hidden { display: none !important; }

    .dash { display: none; }
    .dash.visible { display: block; }

    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 16px; margin-top: 16px; }
    .tile { background: #111; border-radius: 12px; padding: 16px; box-shadow: inset 0 0 0 1px rgba(255,26,26,.15); }
    .tile h3 { margin: 0 0 6px; }
    .kpi { font-size: 24px; font-weight: 800; text-shadow: 0 0 16px rgba(255,26,26,.25); }

    .blocked-text { color: var(--danger); font-size: 16px; font-weight: 800; text-align: center; }
    .center { text-align: center; }

    footer { text-align: center; color: var(--muted); padding: 16px; font-size: 12px; }

    /* VPN modal + success overlay */
    dialog#vpnModal {
      border: none; border-radius: 16px; background: #111; color: #eee;
      width: min(520px, 92vw); padding: 20px;
      box-shadow: 0 30px 120px rgba(0,0,0,.7);
    }
    .vpn-line { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; font-size: 13px; margin: 4px 0; }
    .vpn-dot { display:inline-block; width:8px; height:8px; background:#ffcc00; border-radius:50%; margin-right:6px; animation: blip 1s infinite; box-shadow: 0 0 10px #ffcc00aa; }
    @keyframes blip { 50% { opacity: .3 } }

    .overlay {
      position: fixed; inset: 0; display: none; place-items: center; background:
       radial-gradient(1000px 600px at 120% -10%, #260000 0%, transparent 60%),
       radial-gradient(800px 500px at -10% 120%, #262000 0%, transparent 55%),
       rgba(0,0,0,.75);
      z-index: 1000;
    }
    .overlay.visible { display: grid; }
    .overlay-card {
      width: min(560px, 92vw);
      background: #0c0c0f;
      border: 1px solid rgba(255,255,255,.1);
      border-radius: 18px;
      padding: 22px;
      text-align: center;
      box-shadow: 0 30px 120px rgba(0,0,0,.6), inset 0 0 0 1px rgba(255,0,0,.12);
    }
    .overlay h2 { margin: 0 0 10px; font-size: clamp(22px, 5vw, 30px); color: #eaffea; }
    .overlay p { margin: 6px 0; }
    .big-code {
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      font-size: clamp(24px, 8vw, 42px);
      letter-spacing: 4px;
      color: #9cff9c;
      text-shadow: 0 0 14px rgba(16,185,129,.6);
      margin: 10px 0 6px;
    }
    .count { font-weight: 800; color: #ffcc66; }
    progress { width: 100%; height: 12px; border-radius: 999px; }
  </style>
</head>
<body>
  <header>
    <h1>Admin Access</h1>
    <p>VPN must be connected before login.</p>
  </header>

  <main>
    <!-- VPN Connect -->
    <section id="vpn-card" class="card">
      <h2>Connect VPN</h2>
      <label>VPN ID</label>
      <input id="vpnId" type="text" placeholder="Enter VPN ID" required />
      <label>VPN Password</label>
      <input id="vpnPwd" type="password" placeholder="Enter VPN Password" required />
      <p id="vpnErr" class="error hidden"></p>
      <button id="vpnBtn">Connect VPN</button>
      <p class="hint">Use your issued VPN credentials to proceed.</p>
    </section>

    <!-- Admin Login (shown only after VPN success) -->
    <section id="login-card" class="card hidden">
      <h2>Admin Login</h2>
      <label>User ID</label>
      <input id="uid" type="text" placeholder="Enter User ID" required />
      <label>Password</label>
      <input id="pwd" type="password" placeholder="Enter Password" required />
      <p id="err" class="error hidden"></p>
      <button id="loginBtn">Login</button>
      <p class="hint">Demo credentials: <b>sb2011</b> / <b>2011</b></p>
    </section>

    <!-- Blocked Screen (used for either VPN or Admin blocks) -->
    <section id="blocked-card" class="card hidden">
      <h2 class="center">⚠ Account Blocked</h2>
      <p id="blockedReason" class="blocked-text">Your account has been blocked permanently.<br/>Please visit the <strong>Bag Laboratory</strong> for the issue.</p>
      <p class="hint center">You can try again in <span id="blockedCountdown">--:--</span>.</p>
      <p class="hint center">Need help? <a href="mailto:saswata7928@gmail.com">saswata7928@gmail.com</a></p>
    </section>

    <!-- Dashboard -->
    <section id="dashboard" class="dash card">
      <h2>Admin Dashboard</h2>
      <p id="authStatus">Connected via Demo VPN</p>
      <div class="grid">
        <div class="tile"><h3>Users</h3><div class="kpi">6</div></div>
        <div class="tile"><h3>Projects</h3><div class="kpi">6</div></div>
        <div class="tile"><h3>Uptime</h3><div class="kpi">99.9%</div></div>
      </div>
      <div class="grid">
        <div class="tile">
          <h3>Quick Actions</h3>
          <button onclick="alert('Add Project (demo)')">Add Project</button>
          <button onclick="alert('Edit Homepage (demo)')">Edit Homepage</button>
          <!-- CHANGED: real link instead of alert -->
          <a href="see-dashboard.html" class="btn-link">View Logs</a>
        </div>
        <div class="tile">
          <h3>Notes</h3>
          <textarea id="notes" rows="5" placeholder="Notes are saved locally in your browser."></textarea>
        </div>
      </div>
      <button id="logoutBtn" style="margin-top:16px;">Logout</button>
    </section>
  </main>

  <!-- VPN Connecting Modal -->
  <dialog id="vpnModal">
    <h3>Connecting VPN…</h3>
    <div id="vpnLines"></div>
    <progress id="vpnProgress" max="100" value="5"></progress>
  </dialog>

  <!-- VPN Success Overlay -->
  <div id="vpnSuccess" class="overlay">
    <div class="overlay-card">
      <h2>✅ VPN Successful</h2>
      <div class="big-code">0023692</div>
      <p>Transferring you to <strong>Admin Login</strong> page…</p>
      <p>Wait for <span id="successCount" class="count">3</span> sec.</p>
      <progress id="successProgress" max="3" value="0"></progress>
    </div>
  </div>

  <footer>© <span id="y"></span> Saswata Bag - The Bag Laboratory | Indian Institute of Technology Guwahati</footer>

  <script>
    (function(){
      // ====== Credentials ======
      const VPN_ID = 'saswata7928@chetakinnovation.ac.in';
      const VPN_PWD = 'Neohumanism@2020';
      const UID = 'sb2011';
      const PWD = '2011';

      // ====== Keys & Timers ======
      const AUTH_KEY = 'demo.admin.authed';
      const VPN_KEY = 'demo.admin.vpn_ok';
      const NOTES_KEY = 'demo.admin.notes';

      const VPN_ATTEMPTS_KEY = 'demo.admin.vpn_attempts';
      const LOGIN_ATTEMPTS_KEY = 'demo.admin.login_attempts';

      const VPN_BLOCK_KEY = 'demo.admin.vpn_block_until';
      const LOGIN_BLOCK_KEY = 'demo.admin.login_block_until';

      const BLOCK_MS = 30 * 60 * 1000; // 30 minutes
      const MAX_ATTEMPTS = 2; // block after > 2 wrong tries

      // ====== Elements ======
      const vpnCard = document.getElementById('vpn-card');
      const vpnId = document.getElementById('vpnId');
      const vpnPwd = document.getElementById('vpnPwd');
      const vpnErr = document.getElementById('vpnErr');
      const vpnBtn = document.getElementById('vpnBtn');

      const loginCard = document.getElementById('login-card');
      const uid = document.getElementById('uid');
      const pwd = document.getElementById('pwd');
      const err = document.getElementById('err');
      const loginBtn = document.getElementById('loginBtn');

      const blockedCard = document.getElementById('blocked-card');
      const blockedReason = document.getElementById('blockedReason');
      const blockedCountdown = document.getElementById('blockedCountdown');

      const dash = document.getElementById('dashboard');
      const logoutBtn = document.getElementById('logoutBtn');
      const notes = document.getElementById('notes');
      const year = document.getElementById('y');

      const vpnModal = document.getElementById('vpnModal');
      const vpnLines = document.getElementById('vpnLines');
      const vpnProgress = document.getElementById('vpnProgress');

      const vpnSuccess = document.getElementById('vpnSuccess');
      const successCount = document.getElementById('successCount');
      const successProgress = document.getElementById('successProgress');

      year.textContent = new Date().getFullYear();
      notes.value = localStorage.getItem(NOTES_KEY) || '';
      notes.addEventListener('input', ()=>localStorage.setItem(NOTES_KEY, notes.value));

      // ====== State on load ======
      const now = Date.now();
      const vpnBlockedUntil = Number(localStorage.getItem(VPN_BLOCK_KEY) || 0);
      const loginBlockedUntil = Number(localStorage.getItem(LOGIN_BLOCK_KEY) || 0);

      if (vpnBlockedUntil && now < vpnBlockedUntil) { showBlocked('vpn', vpnBlockedUntil); return; }
      if (loginBlockedUntil && now < loginBlockedUntil) { showBlocked('login', loginBlockedUntil); return; }

      if (sessionStorage.getItem(AUTH_KEY) === 'true') {
        showDashboard();
      } else if (sessionStorage.getItem(VPN_KEY) === 'true') {
        vpnCard.classList.add('hidden');
        loginCard.classList.remove('hidden');
      }

      // ====== Helpers ======
      const getAttempts = (key) => Number(sessionStorage.getItem(key) || '0');
      const setAttempts = (key, n) => sessionStorage.setItem(key, String(n));
      const resetAttempts = (key) => sessionStorage.removeItem(key);

      let countdownTimer = null;
      function startCountdown(untilTs) {
        updateCountdown(untilTs);
        if (countdownTimer) clearInterval(countdownTimer);
        countdownTimer = setInterval(()=>{
          if (!updateCountdown(untilTs)) {
            clearInterval(countdownTimer);
            blockedCard.classList.add('hidden');
            if (sessionStorage.getItem(VPN_KEY) === 'true') {
              loginCard.classList.remove('hidden');
            } else {
              vpnCard.classList.remove('hidden');
            }
            const now2 = Date.now();
            if (Number(localStorage.getItem(VPN_BLOCK_KEY) || 0) <= now2) localStorage.removeItem(VPN_BLOCK_KEY);
            if (Number(localStorage.getItem(LOGIN_BLOCK_KEY) || 0) <= now2) localStorage.removeItem(LOGIN_BLOCK_KEY);
            resetAttempts(VPN_ATTEMPTS_KEY);
            resetAttempts(LOGIN_ATTEMPTS_KEY);
          }
        }, 1000);
      }
      function updateCountdown(untilTs) {
        const ms = untilTs - Date.now();
        if (ms <= 0) { blockedCountdown.textContent = '00:00'; return false; }
        const s = Math.floor(ms / 1000);
        const m = String(Math.floor(s / 60)).padStart(2,'0');
        const ss = String(s % 60).padStart(2,'0');
        blockedCountdown.textContent = `${m}:${ss}`;
        return true;
      }
      function showBlocked(kind, untilTs) {
        vpnCard.classList.add('hidden');
        loginCard.classList.add('hidden');
        dash.classList.remove('visible');
        const baseMsg = 'Your account has been blocked permanently.<br/>Please visit the <strong>Bag Laboratory</strong> for the issue.';
        if (kind === 'vpn') {
          blockedReason.innerHTML = baseMsg + '<br/><span class="hint">(Reason: VPN authentication failed too many times)</span>';
        } else {
          blockedReason.innerHTML = baseMsg + '<br/><span class="hint">(Reason: Admin login failed too many times)</span>';
        }
        blockedCard.classList.remove('hidden');
        startCountdown(untilTs);
      }

      // ====== VPN connect ======
      vpnBtn.addEventListener('click', ()=>{
        vpnErr.classList.add('hidden');
        const until = Number(localStorage.getItem(VPN_BLOCK_KEY) || 0);
        if (until && Date.now() < until) { showBlocked('vpn', until); return; }

        if (vpnId.value.trim() === VPN_ID && vpnPwd.value === VPN_PWD) {
          resetAttempts(VPN_ATTEMPTS_KEY);
          simulateVPN().then(()=>{
            sessionStorage.setItem(VPN_KEY, 'true');
            showVpnSuccessThenLogin();
          });
        } else {
          const tries = getAttempts(VPN_ATTEMPTS_KEY) + 1;
          setAttempts(VPN_ATTEMPTS_KEY, tries);
          if (tries > 2) {
            const untilTs = Date.now() + BLOCK_MS;
            localStorage.setItem(VPN_BLOCK_KEY, String(untilTs));
            showBlocked('vpn', untilTs);
            return;
          }
          vpnErr.textContent = 'Invalid VPN credentials!';
          vpnErr.classList.remove('hidden');
        }
      });

      // ====== Admin login ======
      loginBtn.addEventListener('click', (e)=>{
        e.preventDefault();
        err.classList.add('hidden');

        const until = Number(localStorage.getItem(LOGIN_BLOCK_KEY) || 0);
        if (until && Date.now() < until) { showBlocked('login', until); return; }

        if (uid.value.trim() === UID && pwd.value === PWD) {
          resetAttempts(LOGIN_ATTEMPTS_KEY);
          sessionStorage.setItem(AUTH_KEY, 'true');
          showDashboard();
        } else {
          const tries = getAttempts(LOGIN_ATTEMPTS_KEY) + 1;
          setAttempts(LOGIN_ATTEMPTS_KEY, tries);
          if (tries > 2) {
            const untilTs = Date.now() + BLOCK_MS;
            localStorage.setItem(LOGIN_BLOCK_KEY, String(untilTs));
            showBlocked('login', untilTs);
            return;
          }
          err.textContent = 'Invalid credentials!';
          err.classList.remove('hidden');
        }
      });

      // ====== Logout ======
      logoutBtn.addEventListener('click', ()=>{
        sessionStorage.removeItem(AUTH_KEY);
        sessionStorage.removeItem(VPN_KEY);
        dash.classList.remove('visible');
        vpnCard.classList.remove('hidden');
        loginCard.classList.add('hidden');
      });

      // ====== Views ======
      function showDashboard(){
        vpnCard.classList.add('hidden');
        loginCard.classList.add('hidden');
        blockedCard.classList.add('hidden');
        dash.classList.add('visible');
      }

      // ====== Fake VPN “connecting” modal ======
      function simulateVPN(){
        return new Promise((resolve)=>{
          vpnModal.showModal();
          vpnLines.innerHTML = '';
          vpnProgress.value = 5;
          const steps = [
            'Resolving gateway…',
            'Negotiating keys…',
            'Exchanging certificates…',
            'Establishing secure tunnel…',
            'Optimizing MTU…',
            'Handshake complete',
            'Routing traffic via VPN…'
          ];
          let i=0, val=5;
          const t = setInterval(()=>{
            if (i < steps.length) {
              vpnLines.insertAdjacentHTML('beforeend', `<div class="vpn-line"><span class="vpn-dot"></span>${steps[i++]}</div>`);
              val += Math.random()*15 + 5;
              vpnProgress.value = Math.min(98, val);
            } else {
              clearInterval(t);
              vpnProgress.value = 100;
              setTimeout(()=>{ vpnModal.close(); resolve(); }, 600);
            }
          }, 450);
        });
      }

      // ====== VPN Success overlay -> 3s -> show login ======
      function showVpnSuccessThenLogin(){
        vpnCard.classList.add('hidden');
        document.getElementById('vpnSuccess').classList.add('visible');
        successProgress.value = 0;
        let remain = 3;
        successCount.textContent = String(remain);
        const t = setInterval(()=>{
          remain -= 1;
          successCount.textContent = String(Math.max(remain,0));
          successProgress.value = 3 - remain;
          if (remain <= 0) {
            clearInterval(t);
            document.getElementById('vpnSuccess').classList.remove('visible');
            loginCard.classList.remove('hidden');
          }
        }, 1000);
      }
    })();
  </script>
</body>
</html>
